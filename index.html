<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clima Solar - NASA Space Challenge</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <button class="menu-toggle" id="menuToggle">
        <span class="menu-line"></span>
        <span class="menu-line"></span>
        <span class="menu-line"></span>
    </button>

    <div class="menu-overlay" id="menuOverlay">
        <div class="menu-content">
            <a href="#inicio">Home</a>
            <a href="#capitulo1">Chapter 1</a>
            <a href="#capitulo2">Chapter 2</a>
            <a href="#capitulo3">Chapter 3</a>
            <a href="#capitulo4">Chapter 4</a>
            <a href="#capitulo5">Chapter 5</a>
            <a href="#capitulo6">Chapter 6</a>
            <a href="#capitulo7">Chapter 7</a>
        </div>
    </div>

    <section id="inicio" class="scrolly-video">
        <video id="svVideo" playsinline muted preload="auto">
            <source src="assets/videos/Llamarada2.mp4" type="video/mp4">
        </video>

        <div class="content">
            <h1 class="logo">Capi the astronaut</h1>
            <p class="tagline">Capi and the Solar Storm</p>
            <a href="#capitulo1" class="comenzar-btn">Start</a>
        </div>
    </section>


    <!-- Chapter 1-->
    <section id="capitulo1" class="info-section2">
        <div class="info-content">
            <h2 class="tagline">Capi and the Solar Storm</h2>
            <div class="story-container">
                <h3 class="chapter-title">Chapter 1: Capi’s Dream</h3>
                <div class="story-content">
                    <p>
                        Once upon a time, there was a capybara named <span class="story-highlight">Capi</span> who dreamed of traveling to the stars. Every night he looked at the Moon and wondered:
                        —What would it be like to be up there?
                        Capi studied with great dedication, and one day he was chosen to become an astronaut. His mission: to travel to the Moon and learn about space weather, those phenomena born on the Sun that, even from so far away, can change life on Earth.
                    </p>
                    
                    <div class="material-button-container">
                        <button class="comenzar-btn" onclick="openMaterialModal('https://my.spline.design/moonparallax-A5SjHc7nl9CDs13PI8qxvqGb/')">
                            Watch 3D Material
                        </button>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="nav-btn" onclick="window.location.href='#1'" style="visibility: hidden;">Anterior</button>
                    <button class="nav-btn" onclick="window.location.href='#capitulo2'">Next Chapter</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Chapter 2 -->
    <section id="capitulo2" class="info-section">
        <div class="info-content">
            <h2 class="tagline">Capi and the Solar Storm</h2>
            <div class="story-container">
                <h3 class="chapter-title">Chapter 2: The Animals’ Laughter</h3>
                <div class="story-content">
                    <p>At school, the other animals laughed at him.</p>
                    <p class="story-quote">"Capybaras don’t go to space!" —said a parrot.</p>
                    <p class="story-quote">"And they certainly can’t fight the Sun," —laughed a fox.</p>
                    <p>But Capi never gave up. He learned that space weather is like weather on Earth, but 
                        it happens in space: solar flares, solar wind, and storms that travel at incredible speeds.
                        Capi dreamed of using that knowledge to help people.</p>
                    
                    <div class="material-button-container">
                        <button class="comenzar-btn" onclick="openMaterialModal('https://my.spline.design/timeliquid-78Ah6wW1rGMtBQFAG1Oay9Y2/')">
                            Watch 3D Material
                        </button>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="nav-btn" onclick="window.location.href='#capitulo1'">Last Chapter</button>
                    <button class="nav-btn" onclick="window.location.href='#capitulo3'">Next Chapter</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Chapter 3 -->
    <section id="capitulo3" class="info-section2">
        <div class="info-content">
            <h2 class="tagline">Capi and the Solar Storm</h2>
            <div class="story-container">
                <h3 class="chapter-title">Chapter 3: Apollo Capybara 1</h3>
                <div class="story-content">
                    <p>The big day arrived. Capi boarded the Apollo Capybara 1 spacecraft with his partner Don Tortoise. 
                    As they traveled toward the Moon, the scientists warned him:</p>
                    <p class="story-quote">"The Sun is very active, prepare for a solar flare".</p>
                    <p>A solar flare is like a giant sneeze from the Sun, sending energy and particles out into space.
                    And when they reach Earth, they can cause bright auroras but also problems with technology.</p>
                    <div class="material-button-container">
                        <button class="comenzar-btn" onclick="openMaterialModal('https://my.spline.design/interactivespaceshipscene-9Izbi3UKp93vHKmSUF0FMXLz/')">
                            Watch 3D Material
                        </button>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="nav-btn" onclick="window.location.href='#capitulo2'">Last Chapter</button>
                    <button class="nav-btn" onclick="window.location.href='#capitulo4'">Next Chapter</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Chapter 4  -->
    <section id="capitulo4" class="info-section">
        <div class="info-content">
            <h2 class="tagline">Capi and the Solar Storm</h2>
            <div class="story-container">
                <h3 class="chapter-title">Chapter 4: The Solar Storm</h3>
                <div class="story-content">
                    <p>Suddenly, alarms rang: a solar flare was heading toward Earth!
                    On Earth, farmers saw their GPS systems stop working and couldn’t guide their tractors.
                    Pilots in airplanes heard static on the radios and lost communication for a while. Satellite
                    operators noticed some machines turning off in space. And in several cities, lights flickered
                    as electricity grids were disturbed. Meanwhile, on the Moon, Capi saw glowing lights dancing
                    in the sky: auroras created by the solar storm, though they looked different than on Earth.</p>
                    
                    <div class="material-button-container">
                        <button class="comenzar-btn" onclick="openMaterialModal('https://my.spline.design/astarlikeourown-zYeB2LPjeIUpxyEHn2eONDQb/')">
                            Watch 3D Material
                        </button>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="nav-btn" onclick="window.location.href='#capitulo3'">Last Chapter</button>
                    <button class="nav-btn" onclick="window.location.href='#capitulo5'">Next Chapter</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Chapter 5  -->
    <section id="capitulo5" class="info-section2">
        <div class="info-content">
            <h2 class="tagline">Capi and the Solar Storm</h2>
            <div class="story-container">
                <h3 class="chapter-title">Chapter 5: Danger on the Moon</h3>
                <div class="story-content">
                    <p>Capi and Don Tortoise had to get back to the ship. Radiation could damage their suits if they stayed outside too long.</p>
                    <p class="story-quote">—"Quick, Capi!" —shouted Don Tortoise.</p>
                    <p>But Capi couldn’t stop thinking about the people on Earth: farmers without GPS,
                        pilots without communication, astronauts on the Space Station protecting themselves 
                        inside special modules. That solar storm was affecting everyone at the same time.</p>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="nav-btn" onclick="window.location.href='#capitulo4'">Last Chapter</button>
                    <button class="nav-btn" onclick="window.location.href='#capitulo6'">Next Chapter</button>
                </div>
            </div>
        </div>
    </section>
    <!-- Chapter 6-->
    <section id="capitulo6" class="info-section">
        <div class="info-content">
            <h2 class="tagline">Capi and the Solar Storm</h2>
            <div class="story-container">
                <h3 class="chapter-title">Chapter 6: The End of Capi?</h3>
                <div class="story-content">
                    <p>Capi ran toward the ship but tripped on a rock. The safety clock on his suit showed
                        one minute before the radiation became too strong.
                        He knew space weather couldn’t be controlled, but we could learn about it to be prepared. 
                        Capi took a deep breath, and with one last effort, he rushed to the ship.</p>
                </div>
                <div class="navigation-buttons">
                    <button class="nav-btn" onclick="window.location.href='#capitulo5'">Last Chapter</button>
                    <button class="nav-btn" onclick="window.location.href='#capitulo7'">Next Chapter</button>
                </div>
            </div>
        </div>
    </section>
        <!-- Chapter 7  -->
    <section id="capitulo7" class="info-section2">
        <div class="info-content">
            <h2 class="tagline">Capi and the Solar Storm</h2>
            <div class="story-container">
                <h3 class="chapter-title">Chapter 7: Capi the Hero</h3>
                <div class="story-content">
                    <p>Capi and Don Tortoise managed to enter just in time. The spacecraft started its engines and headed home.
                        Back on Earth, Capi explained what he had seen: how a solar flare affects farmers, pilots, satellites, power grids, and astronauts.
                        His mission taught that space weather is powerful, but with knowledge and teamwork we can protect ourselves.
                        That day, Capi not only fulfilled his dream of going to space: he also became a hero who helped everyone understand the Sun.</p>
                    
                    <div class="material-button-container">
                        <button class="comenzar-btn" onclick="openMaterialModal('https://my.spline.design/fireworks-Sxdcen6eotaILUj8N1XIn2N4/')">
                            Watch 3D Material
                        </button>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="nav-btn" onclick="window.location.href='#capitulo6'">Last Chapter</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal para el material 3D -->
    <div id="materialModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Modelo 3D</h3>
                <button class="close-btn" onclick="closeMaterialModal()">&times;</button>
            </div>
            <div class="modal-body">
                <iframe 
                    id="modelFrame"
                    src="" 
                    class="model-3d"
                    frameborder="0"
                    allowfullscreen>
                </iframe>
            </div>
            <div class="modal-footer">
                <button class="nav-btn" onclick="closeMaterialModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <script>
        const menuToggle = document.getElementById('menuToggle');
        const menuOverlay = document.getElementById('menuOverlay');
        
        menuToggle.addEventListener('click', function() {
            this.classList.toggle('active');
            menuOverlay.classList.toggle('active');
        });
        
        const menuLinks = document.querySelectorAll('.menu-content a');
        menuLinks.forEach(link => {
            link.addEventListener('click', function() {
                menuToggle.classList.remove('active');
                menuOverlay.classList.remove('active');
            });
        });

        menuOverlay.addEventListener('click', function(e) {
            if (e.target === menuOverlay) {
                menuToggle.classList.remove('active');
                menuOverlay.classList.remove('active');
            }
        });

        
        let scrollPosition = 0;

        function openMaterialModal(modelUrl) {
            const modal = document.getElementById('materialModal');
            const modelFrame = document.getElementById('modelFrame');
            const body = document.body;
            
            modelFrame.src = modelUrl;
            

            scrollPosition = window.pageYOffset;
            
        
            body.classList.add('modal-open');
          
            body.style.top = `-${scrollPosition}px`;
  
            modal.style.display = 'block';
        }

        function closeMaterialModal() {
            const modal = document.getElementById('materialModal');
            const modelFrame = document.getElementById('modelFrame');
            const body = document.body;

            modal.style.display = 'none';
    
            modelFrame.src = '';
            
  
            body.classList.remove('modal-open');

            window.scrollTo(0, scrollPosition);
            
            body.style.top = '';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('materialModal');
            if (event.target === modal) {
                closeMaterialModal();
            }
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeMaterialModal();
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const iframe = document.querySelector('.model-3d');
            iframe.addEventListener('mouseenter', function() {
                document.body.style.overflow = 'hidden';
            });
            iframe.addEventListener('mouseleave', function() {
                if (document.body.classList.contains('modal-open')) {
                    document.body.style.overflow = 'hidden';
                } else {
                    document.body.style.overflow = '';
                }
            });
        });
    </script>
    <script>
        (() => {
        const section = document.getElementById('inicio');  
        const video   = document.getElementById('svVideo');
        let duration  = 0;

        let sectionTop   = 0;
        let sectionHeight= 0;
        let viewportH    = window.innerHeight;

        const measure = () => {
            sectionTop    = section.offsetTop;
            sectionHeight = section.offsetHeight;
            viewportH     = window.innerHeight;
        };
        measure();
        new ResizeObserver(measure).observe(section);
        window.addEventListener('resize', measure);

        video.addEventListener('loadedmetadata', () => {
            duration = video.duration || 0;
            video.pause();
        });

        const clamp = (x, a, b) => Math.min(Math.max(x, a), b);

        const progressFromScroll = () => {
            const scrollY = window.scrollY;
            const start   = sectionTop;
            const travel  = Math.max(1, sectionHeight - viewportH); 
            const p       = (scrollY - start) / travel;
            return clamp(p, 0, 1);
        };
        let targetTime = 0;
        let rafId;

        const tick = () => {
            if (duration > 0) {
                if (targetTime < 0.02) {
                if (video.currentTime !== 0) video.currentTime = 0;
                } else if (targetTime > duration - 0.02) {
                if (video.currentTime !== duration) video.currentTime = duration;
                } else {
                const factor = 0.22; 
                const diff   = targetTime - video.currentTime;
                if (Math.abs(diff) > 0.002) {
                    video.currentTime += diff * factor;
                }
                }
            }
            rafId = requestAnimationFrame(tick);
        };


        const onScroll = () => {
            const p = progressFromScroll();
            if (duration > 0) targetTime = p * duration;
        };

        const prefersReduce = window.matchMedia('(prefers-reduced-motion: reduce)');
        const applyReduce = () => {
            if (prefersReduce.matches) {
            cancelAnimationFrame(rafId);
            window.removeEventListener('scroll', onScroll);
            video.currentTime = 0;
            video.pause();
            } else {
            if (!rafId) rafId = requestAnimationFrame(tick);
            window.addEventListener('scroll', onScroll, { passive:true });
            onScroll(); 
            }
        };
        prefersReduce.addEventListener?.('change', applyReduce);

        applyReduce();
        })();
    </script>

</body>
</html>