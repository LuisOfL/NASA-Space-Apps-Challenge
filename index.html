<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clima Solar - NASA Space Challenge</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <button class="menu-toggle" id="menuToggle">
        <span class="menu-line"></span>
        <span class="menu-line"></span>
        <span class="menu-line"></span>
    </button>
  
    <div class="menu-overlay" id="menuOverlay">
        <div class="menu-content">
            <a href="#inicio">Inicio</a>
            <a href="#capitulo1">Capítulo 1</a>
            <a href="#capitulo2">Capítulo 2</a>
            <a href="#capitulo3">Capítulo 3</a>
            <a href="#capitulo4">Capítulo 4</a>
            <a href="#capitulo5">Capítulo 5</a>
            <a href="#capitulo6">Capítulo 6</a>
            <a href="#capitulo7">Capítulo 7</a>
        </div>
    </div>

    <section id="inicio" class="scrolly-video">
        <video id="svVideo" playsinline muted preload="auto">
            <source src="assets/videos/Llamarada2.mp4" type="video/mp4">
        </video>

        <div class="content">
            <h1 class="logo">Capi el astronauta</h1>
            <p class="tagline">¡El sueño imposible!</p>
            <a href="#capitulo1" class="comenzar-btn">Comenzar</a>
        </div>
    </section>


    <!-- Capítulo 1-->
    <section id="capitulo1" class="info-section2">
        <div class="info-content">
            <h2 class="tagline">La Aventura Espacial de Capi</h2>
            <div class="story-container">
                <h3 class="chapter-title">Capítulo 1: El sueño de Capi</h3>
                <div class="story-content">
                    <p>Había una vez un pequeño capibara llamado <span class="story-highlight">Capi</span>, que vivía en un pueblo. 
                       Capi era curioso, le encantaba mirar las estrellas todas las noches. Soñaba con tocar las estrellas algún día.
                    </p>
                    
                    <div class="material-button-container">
                        <button class="comenzar-btn" onclick="openMaterialModal('https://my.spline.design/moonparallax-A5SjHc7nl9CDs13PI8qxvqGb/')">
                             Ver Material 3D
                        </button>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="nav-btn" onclick="window.location.href='#1'" style="visibility: hidden;">Anterior</button>
                    <button class="nav-btn" onclick="window.location.href='#capitulo2'">Siguiente Capítulo</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Capítulo 2 -->
    <section id="capitulo2" class="info-section">
        <div class="info-content">
            <h2 class="tagline">La Aventura Espacial de Capi</h2>
            <div class="story-container">
                <h3 class="chapter-title">Capítulo 2: La burla de los animales</h3>
                <div class="story-content">
                    <p>Los otros animales se burlaban de Capi en la escuela.</p>
                    <p class="story-quote">"Pero, Capi, ¡los capibaras no van al espacio!" —le dijo un loro.</p>
                    <p class="story-quote">"Ya lo verás" —respondió Capi, decidido.</p>
                    <p>Pasaron los años, y Capi estudió mucho. Siempre interesado en los fenómenos espaciales, 
                        entró a la mejor universidad del mundo y ganó muchos concursos.</p>
                    
                    <div class="material-button-container">
                        <button class="comenzar-btn" onclick="openMaterialModal('https://my.spline.design/timeliquid-78Ah6wW1rGMtBQFAG1Oay9Y2/')">
                             Ver Material 3D    (Presiona E)
                        </button>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="nav-btn" onclick="window.location.href='#capitulo1'">Capítulo Anterior</button>
                    <button class="nav-btn" onclick="window.location.href='#capitulo3'">Siguiente Capítulo</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Capítulo 3 -->
    <section id="capitulo3" class="info-section2">
        <div class="info-content">
            <h2 class="tagline">La Aventura Espacial de Capi</h2>
            <div class="story-container">
                <h3 class="chapter-title">Capítulo 3: Apolo Capibara 1</h3>
                <div class="story-content">
                    <p>Finalmente, llegó el gran día: Capi fue elegido para una misión especial llamada <span class="story-highlight">Apolo Capibara 1</span>.</p>
                    <p>Su misión consistía en explorar la luna en busca de vida.</p>
                    <p>Capibara estaba nervioso, el único capibara que había ido al espacio nunca volvió.</p>
                    <p>Sabia que podia ocurrir una llamarada solar gigante cuando el este en la luna, una llamarada 
                        solar es una explosión repentina y muy intensa de energía en la superficie del Sol, causada 
                        por la liberación de energía acumulada en su campo magnético.</p>
                    
                    <div class="material-button-container">
                        <button class="comenzar-btn" onclick="openMaterialModal('https://my.spline.design/interactivespaceshipscene-9Izbi3UKp93vHKmSUF0FMXLz/')">
                             Ver Material 3D
                        </button>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="nav-btn" onclick="window.location.href='#capitulo2'">Capítulo Anterior</button>
                    <button class="nav-btn" onclick="window.location.href='#capitulo4'">Siguiente Capítulo</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Capítulo 4  -->
    <section id="capitulo4" class="info-section">
        <div class="info-content">
            <h2 class="tagline">La Aventura Espacial de Capi</h2>
            <div class="story-container">
                <h3 class="chapter-title">Capítulo 4: La tormenta solar</h3>
                <div class="story-content">
                    <p>Capibara había llegado a la luna, decidió explorar, estaba tan emocionado que no se dio cuenta que se alejaba de la nave.</p>
                    <p>Mientras tanto en la tierra las auroras aparecían en lugares inesperados, los satélites fallaban</p>
                    <p class="story-quote">"Capibara vuelve, vuelve" — Sonó la radio de su traje.</p>
                    <p class="story-quote">"Repito, vuelve"</p>
                    <p>Capi corrió, estaba muy lejos de la nave, corrió y corrió, pero justo cuando iba a llegar vio a lo lejos algo moviéndose.</p>
                    <p>Era su compañero de viaje Don Tortuga.</p>
                    
                    <div class="material-button-container">
                        <button class="comenzar-btn" onclick="openMaterialModal('https://my.spline.design/astarlikeourown-zYeB2LPjeIUpxyEHn2eONDQb/')">
                             Ver Material 3D
                        </button>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="nav-btn" onclick="window.location.href='#capitulo3'">Capítulo Anterior</button>
                    <button class="nav-btn" onclick="window.location.href='#capitulo5'">Siguiente Capítulo</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Capítulo 5  -->
    <section id="capitulo5" class="info-section2">
        <div class="info-content">
            <h2 class="tagline">La Aventura Espacial de Capi</h2>
            <div class="story-container">
                <h3 class="chapter-title">Capítulo 5: Capi el héroe</h3>
                <div class="story-content">
                    <p>Capi tenía que decidir si entrar a la nave o salvar a su compañero, tenía el tiempo medido.</p>
                    <p>Capi decidió salvar a su compañero tortuga, Capi sabía que no saldría con vida, pero igual lo intentó.</p>
                    <p>Capi lo ayudó a correr.</p>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="nav-btn" onclick="window.location.href='#capitulo4'">Capítulo Anterior</button>
                    <button class="nav-btn" onclick="window.location.href='#capitulo6'">Siguiente Capítulo</button>
                </div>
            </div>
        </div>
    </section>
      <!-- Capítulo 6-->
    <section id="capitulo6" class="info-section2">
        <div class="info-content">
            <h2 class="tagline">La Aventura Espacial de Capi</h2>
            <div class="story-container">
                <h3 class="chapter-title">Capítulo 6: ¿Capi muere?</h3>
                <div class="story-content">
                    <p>Capi aventó a tortuga a la nave.</p>
                    <p>Tenía 1 minuto para subir a la nave pero su pie se atoró y tropezó.</p>
                </div>
                <div class="navigation-buttons">
                    <button class="nav-btn" onclick="window.location.href='#capitulo5'">Capítulo Anterior</button>
                    <button class="nav-btn" onclick="window.location.href='#capitulo7'">Siguiente Capítulo</button>
                </div>
            </div>
        </div>
    </section>
        <!-- Capítulo 7  -->
    <section id="capitulo7" class="info-section2">
        <div class="info-content">
            <h2 class="tagline">La Aventura Espacial de Capi</h2>
            <div class="story-container">
                <h3 class="chapter-title">Capítulo 7: Capi el héroe</h3>
                <div class="story-content">
                    <p>Capi alcanzó a saltar a la nave a tiempo.</p>
                    <p>Volvió a la tierra advirtio a la agencia espacial de los problemas con el clima espacial y como le afecto
                        como un héroe y el primer capibara en volver del espacio en la historia.</p>
                    <p>Capi había cumplido un sueño que parecía imposible, ese día les demostró que la perseverancia lo puede todo.</p>
                    
                    <div class="material-button-container">
                        <button class="comenzar-btn" onclick="openMaterialModal('https://my.spline.design/fireworks-Sxdcen6eotaILUj8N1XIn2N4/')">
                             Ver Material 3D
                        </button>
                    </div>
                </div>
                <div class="navigation-buttons">
                    <button class="nav-btn" onclick="window.location.href='#capitulo6'">Capítulo Anterior</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal para el material 3D -->
    <div id="materialModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Modelo 3D</h3>
                <button class="close-btn" onclick="closeMaterialModal()">&times;</button>
            </div>
            <div class="modal-body">
                <iframe 
                    id="modelFrame"
                    src="" 
                    class="model-3d"
                    frameborder="0"
                    allowfullscreen>
                </iframe>
            </div>
            <div class="modal-footer">
                <button class="nav-btn" onclick="closeMaterialModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <script>
        const menuToggle = document.getElementById('menuToggle');
        const menuOverlay = document.getElementById('menuOverlay');
        
        menuToggle.addEventListener('click', function() {
            this.classList.toggle('active');
            menuOverlay.classList.toggle('active');
        });
        
        const menuLinks = document.querySelectorAll('.menu-content a');
        menuLinks.forEach(link => {
            link.addEventListener('click', function() {
                menuToggle.classList.remove('active');
                menuOverlay.classList.remove('active');
            });
        });

        menuOverlay.addEventListener('click', function(e) {
            if (e.target === menuOverlay) {
                menuToggle.classList.remove('active');
                menuOverlay.classList.remove('active');
            }
        });

        
        let scrollPosition = 0;

        function openMaterialModal(modelUrl) {
            const modal = document.getElementById('materialModal');
            const modelFrame = document.getElementById('modelFrame');
            const body = document.body;
            
            modelFrame.src = modelUrl;
            

            scrollPosition = window.pageYOffset;
            
        
            body.classList.add('modal-open');
          
            body.style.top = `-${scrollPosition}px`;
  
            modal.style.display = 'block';
        }

        function closeMaterialModal() {
            const modal = document.getElementById('materialModal');
            const modelFrame = document.getElementById('modelFrame');
            const body = document.body;

            modal.style.display = 'none';
    
            modelFrame.src = '';
            
  
            body.classList.remove('modal-open');

            window.scrollTo(0, scrollPosition);
            
            body.style.top = '';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('materialModal');
            if (event.target === modal) {
                closeMaterialModal();
            }
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeMaterialModal();
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const iframe = document.querySelector('.model-3d');
            iframe.addEventListener('mouseenter', function() {
                document.body.style.overflow = 'hidden';
            });
            iframe.addEventListener('mouseleave', function() {
                if (document.body.classList.contains('modal-open')) {
                    document.body.style.overflow = 'hidden';
                } else {
                    document.body.style.overflow = '';
                }
            });
        });
    </script>
    <script>
        (() => {
        const section = document.getElementById('inicio');  
        const video   = document.getElementById('svVideo');
        let duration  = 0;

        let sectionTop   = 0;
        let sectionHeight= 0;
        let viewportH    = window.innerHeight;

        const measure = () => {
            sectionTop    = section.offsetTop;
            sectionHeight = section.offsetHeight;
            viewportH     = window.innerHeight;
        };
        measure();
        new ResizeObserver(measure).observe(section);
        window.addEventListener('resize', measure);

        video.addEventListener('loadedmetadata', () => {
            duration = video.duration || 0;
            video.pause();
        });

        const clamp = (x, a, b) => Math.min(Math.max(x, a), b);

        const progressFromScroll = () => {
            const scrollY = window.scrollY;
            const start   = sectionTop;
            const travel  = Math.max(1, sectionHeight - viewportH); 
            const p       = (scrollY - start) / travel;
            return clamp(p, 0, 1);
        };
        let targetTime = 0;
        let rafId;

        const tick = () => {
            if (duration > 0) {
                if (targetTime < 0.02) {
                if (video.currentTime !== 0) video.currentTime = 0;
                } else if (targetTime > duration - 0.02) {
                if (video.currentTime !== duration) video.currentTime = duration;
                } else {
                const factor = 0.22; 
                const diff   = targetTime - video.currentTime;
                if (Math.abs(diff) > 0.002) {
                    video.currentTime += diff * factor;
                }
                }
            }
            rafId = requestAnimationFrame(tick);
        };


        const onScroll = () => {
            const p = progressFromScroll();
            if (duration > 0) targetTime = p * duration;
        };

        const prefersReduce = window.matchMedia('(prefers-reduced-motion: reduce)');
        const applyReduce = () => {
            if (prefersReduce.matches) {
            cancelAnimationFrame(rafId);
            window.removeEventListener('scroll', onScroll);
            video.currentTime = 0;
            video.pause();
            } else {
            if (!rafId) rafId = requestAnimationFrame(tick);
            window.addEventListener('scroll', onScroll, { passive:true });
            onScroll(); 
            }
        };
        prefersReduce.addEventListener?.('change', applyReduce);

        applyReduce();
        })();
    </script>

</body>
</html>